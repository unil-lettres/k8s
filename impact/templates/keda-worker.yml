apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ .Values.worker_name }}-keda-hpa
  namespace: {{ .Values.namespace }}
spec:
  scaleTargetRef:
    name: {{ .Values.worker_name }}
  triggers:
  - type: mysql
    metadata:
      host: "10.42.3.3"
      port: "3306"
      dbName: "{{ .Values.ENV.mysql_database }}"
      username: "{{ .Values.ENV.mysql_user }}"
      password: "{{ .Values.ENV.mysql_password }}"
      queryValue: "{{ .Values.hpa_query_value }}"
      activationQueryValue: "{{ .Values.hpa_activation_value }}"
      query: "SELECT COUNT(*) AS count FROM cache_locks WHERE `key` LIKE '%ProcessFile%'"
